/*
 * Copyright 2011 Freescale Semiconductor, Inc.
 * Copyright 2011 Linaro Ltd.
 * Copyright 2012 Genesi USA, Inc.
 *
 * The code contained herein is licensed under the GNU General Public
 * License. You may obtain a copy of the GNU General Public License
 * Version 2 or later at the following locations:
 *
 * http://www.opensource.org/licenses/gpl-license.html
 * http://www.gnu.org/copyleft/gpl.html
 */

/dts-v1/;
/include/ "imx51.dtsi"

/ {
	model = "Genesi Efika MX (Smarttop)";
	compatible = "genesi,imx51-efikamx", "fsl,imx51";

	memory {
		reg = <0x90000000 0x20000000>;
	};

	soc {
		aips@70000000 {
			spba@70000000 {
				esdhc1: esdhc@70004000 {
					pinctrl-names = "default";
					pinctrl-0 = <&pinctrl_esdhc1_1>;
					cd-gpios = <&gpio1 0 0>;
					wp-gpios = <&gpio1 1 0>;
					status = "okay";
				};

				ssi2: ssi@70014000 {
					fsl,mode = "i2s-slave";
					status = "okay";
				};

				ecspi1: ecspi@70010000 {
					pinctrl-names = "default";
					pinctrl-0 = <&pinctrl_ecspi1_1>;
					fsl,spi-num-chipselects = <2>;
					reg = <0x70010000 0x4000>;
					cs-gpios = <&gpio4 24 0>, /* GPIO4_24 */
						   <&gpio4 25 0>; /* GPIO4_25 */
					status = "okay";

					pmic: mc13892@0 {
						#address-cells = <1>;
						#size-cells = <0>;
						compatible = "fsl,mc13892";
						spi-max-frequency = <6000000>;
						reg = <0>;
						interrupt-parent = <&gpio1>;
						interrupts = <6 0x4>;
						fsl,mc13xxx-uses-rtc;

						regulators {
							sw1_reg: sw1 {
								/* VDDGP - PUS_4 (arm core) */
								regulator-min-microvolt = <600000>;
								regulator-max-microvolt = <1100000>;
								regulator-boot-on;
								regulator-always-on;
							};

							sw2_reg: sw2 {
								/* VCC - PUS_0 (peripherals) */
								regulator-min-microvolt = <1225000>;
								regulator-max-microvolt = <1225000>;
								regulator-boot-on;
								regulator-always-on;
							};

							sw3_reg: sw3 {
								/* 1V2_DIG1 - PUS_5 HDMI, VGA */
								regulator-min-microvolt = <1200000>;
								regulator-max-microvolt = <1200000>;
								regulator-boot-on;
								regulator-always-on;
							};

							sw4_reg: sw4 {
								/* 1V8_DIG1 - PUS_1
								 * DDR, DDR-SPD & JTAG/debug board
								 * used as a voltage divider for 2.5V analog (headphone et al.) */
								regulator-min-microvolt = <1100000>;
								regulator-max-microvolt = <1800000>;
								regulator-boot-on;
								regulator-always-on;
							};

							vpll_reg: vpll {
								/* 1V8_ANA_PLL - PUS_6 */
								regulator-min-microvolt = <1800000>;
								regulator-max-microvolt = <1800000>;
								regulator-boot-on;
								regulator-always-on;
							};

							vdig_reg: vdig {
								/* 1V65 - PUS_7 SGTL5000-VDDA */
								regulator-min-microvolt = <1650000>;
								regulator-max-microvolt = <1650000>;
							};

							vsd_reg: vsd {
								/* 3V15 */
								regulator-min-microvolt = <3150000>;
								regulator-max-microvolt = <3150000>;
								regulator-always-on;
							};

							vusb_reg: vusb {
								/* 3V3_USB_MX51 - PUS_9 */
								regulator-min-microvolt = <3300000>;
								regulator-max-microvolt = <3300000>;
								regulator-always-on;
							};

							vusb2_reg: vusb2 {
								/* 2V6 - VCCUSBPHY (MX51) */
								regulator-min-microvolt = <2600000>;
								regulator-max-microvolt = <2600000>;
								regulator-always-on;
							};

							vvideo_reg: vvideo {
								/* 2V775
								 * SPI NOR, I2C2 bus, SGTL5000-VDDIO
								 * technically can be turned off but since
								 * it powers SPI NOR it needs to be back on
								 * at reboot!
								 */
								regulator-min-microvolt = <2775000>;
								regulator-max-microvolt = <2775000>;
								regulator-boot-on;
							};

							vaudio_reg: vaudio {
								/* 3V_ANA */
								regulator-min-microvolt = <3000000>;
								regulator-max-microvolt = <3000000>;
							};

							vcam_reg: vcam {
								/* 2V5 */
								regulator-min-microvolt = <2500000>;
								regulator-max-microvolt = <2500000>;
							};

							vgen1_reg: vgen1 {
								/* 1V2_DIG2 - HDMI, VGA, SGTL5000-VDDD */
								regulator-min-microvolt = <1200000>;
								regulator-max-microvolt = <1200000>;
							};

							vgen2_reg: vgen2 {
								/* 3V15_BOOT - PUS_3 - SPI NOR, SD card, VDD_FUSE */
								regulator-min-microvolt = <3150000>;
								regulator-max-microvolt = <3150000>;
								regulator-always-on;
								regulator-boot-on;
							};

							vgen3_reg: vgen3 {
								/* 1V8_DIG2
								 * required for USB (26MHz clock, USB3317 PHY, ubs, usb resets, audio */
								regulator-min-microvolt = <1800000>;
								regulator-max-microvolt = <1800000>;
								regulator-always-on;
							};

							vviohi_reg: vviohi {
								/* 2V775_BOOT - PUS_2
								 * debug board, SPDIF
								 */
								regulator-min-microvolt = <2775000>;
								regulator-max-microvolt = <2775000>;
								regulator-always-on;
								regulator-boot-on;
							};
						};
					};

					flash: sst25vf032b@1 {
						#address-cells = <1>;
						#size-cells = <1>;
						compatible = "sst,sst25vf032b";
						spi-max-frequency = <25000000>;
						reg = <1>;

						partition@0 {
							label = "firmware";
							rebig = <0x0 0x200000>;
						};

						partition@200000 {
							label = "user";
							reg = <0x200000 0x200000>;
						};
					};
				};
			};

			wdog1: wdog@73f98000 {
				status = "okay";
			};

			iomuxc: iomuxc@73fa8000 {
				compatible = "fsl,imx51-iomuxc";
				reg = <0x73fa8000 0x4000>;

				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_hog>;

				hog {
					pinctrl_hog: hoggrp {
						fsl,pins = <
							51 0x85			/* MX51_PAD_NANDF_RB3__GPIO_3_11 + 100k pullup (PCBID2) */
							53 0x85			/* MX51_PAD_NANDF_CS0__GPIO_3_16 + 100k pullup (PCBID0) */
							54 0x85			/* MX51_PAD_NANDF_CS1__GPIO_3_17 + 100k pullup (PCBID1) */
							402 0x85		/* MX51_PAD_CSPI1_SS0__GPIO4_24 */
							405 0x85		/* MX51_PAD_CSPI1_SS1__GPIO4_25 */
							694 0x85		/* MX51_PAD_GPIO1_0__SD1_CD */
							697 0x85		/* MX51_PAD_GPIO1_1__SD1_WP */
							740 0x40000085		/* MX51_PAD_GPIO1_6__GPIO1_6 (PMIC interrupt) */
							514 0x85		/* MX51_PAD_DISPB2_SER_DIN__GPIO3_5 (SII902x reset) */
							511 0x85		/* MX51_PAD_DI1_D1_CS__GPIO3_4 (SII902x enable) */
							521 0x85		/* MX51_PAD_DISPB2_SER_CLK__GPIO3_7 (VGA enable) */
							169 0x40000085		/* MX51_PAD_EIM_DTACK__GPIO2_31 (power button) */
							517 0x40000085		/* MX51_PAD_DISPB2_SER_DIO__GPIO3_6 (SII902x irq) */
							186 0x40000085		/* MX51_PAD_NANDF_CLE__GPIO3_6 */
						>;
					};
				};

				usbotg {
					pinctrl_usbotg_1: usbotggrp-1 {
						fsl,pins = <
							461 0x1d5
							465 0x1d5
							469 0x1d5
							473 0x1d5
							476 0x1d5
							479 0x1d5
							482 0x1d5
							485 0x1d5
							488 0x1d5
							491 0x1d5
							494 0x1d5
							498 0x1d5
						>;
					};
				};

				display {
					pinctrl_display_1: displaygrp-1 {
						fsl,pins = <
							583 0x10		/* MX51_PAD_DI1_PIN3__DI1_PIN3 */
							584 0x10		/* MX51_PAD_DI1_PIN2__DI1_PIN2 */
							528 0x10		/* MX51_PAD_DISP1_DAT0__DISP1_DAT0 */
							529 0x10		/* MX51_PAD_DISP1_DAT1__DISP1_DAT1 */
							530 0x10		/* MX51_PAD_DISP1_DAT2__DISP1_DAT2 */
							531 0x10		/* MX51_PAD_DISP1_DAT3__DISP1_DAT3 */
							532 0x10		/* MX51_PAD_DISP1_DAT4__DISP1_DAT4 */
							533 0x10		/* MX51_PAD_DISP1_DAT5__DISP1_DAT5 */
							535 0x10		/* MX51_PAD_DISP1_DAT6__DISP1_DAT6 */
							537 0x10		/* MX51_PAD_DISP1_DAT7__DISP1_DAT7 */
							539 0x10		/* MX51_PAD_DISP1_DAT8__DISP1_DAT8 */
							541 0x10		/* MX51_PAD_DISP1_DAT9__DISP1_DAT9 */
							543 0x10		/* MX51_PAD_DISP1_DAT10__DISP1_DAT10 */
							545 0x10		/* MX51_PAD_DISP1_DAT11__DISP1_DAT11 */
							547 0x10		/* MX51_PAD_DISP1_DAT12__DISP1_DAT12 */
							549 0x10		/* MX51_PAD_DISP1_DAT13__DISP1_DAT13 */
							551 0x10		/* MX51_PAD_DISP1_DAT14__DISP1_DAT14 */
							553 0x10		/* MX51_PAD_DISP1_DAT15__DISP1_DAT15 */
							555 0x10		/* MX51_PAD_DISP1_DAT16__DISP1_DAT16 */
							557 0x10		/* MX51_PAD_DISP1_DAT17__DISP1_DAT17 */
							559 0x10		/* MX51_PAD_DISP1_DAT18__DISP1_DAT18 */
							563 0x10		/* MX51_PAD_DISP1_DAT19__DISP1_DAT19 */
							567 0x10		/* MX51_PAD_DISP1_DAT20__DISP1_DAT20 */
							571 0x10		/* MX51_PAD_DISP1_DAT21__DISP1_DAT21 */
							575 0x10		/* MX51_PAD_DISP1_DAT22__DISP1_DAT22 */
							579 0x10		/* MX51_PAD_DISP1_DAT23__DISP1_DAT23 */
						>;
					};
				};
			};

			usbotg: usb@73f80000 {
				compatible = "fsl,imx51-usb", "fsl,imx27-usb";
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_usbotg_1>;
				fsl,usbmisc = <&usbmisc 0>;
				clocks = <&clks 43>, <&clks 43>, <&clks 43>;
				clock-names = "ipg", "ahb", "per";
				dr_mode = "host";
				phy-mode = "utmi";
				status = "okay";
				};

/* Commented out as it needs pinctrl corrected.
			usbhost1: usb@73f80200 {
				compatible = "fsl,imx51-usb", "fsl,imx27-usb";
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_usbotg_1>;
				fsl,usbmisc = <&usbmisc 1>;
				phy-mode = "ulpi";
				ext-clk;
				status = "okay";
			};
*/
			usbmisc: usbmisc@73f80000 {
				#index-cells = <1>;
				compatible = "fsl,imx5x-usbmisc";
			//	clocks = <&clks 124>;
			//	clock-names = "phy";
				reg = <0x73f80800 0x200>;
			};

			uart1: serial@73fbc000 {
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_uart1_1>;
				fsl,uart-has-rtscts;
				status = "okay";
			};

		};

		aips@80000000 {
			sdma: sdma@83fb0000 {
				fsl,sdma-ram-script-name = "imx/sdma/sdma-imx51.bin";
			};

			i2c2: i2c@83fc4000 {
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_i2c2_1>;
				status = "okay";
				clock-frequency = <100000>;

				/*codec: sgtl5000@0a {
					compatible = "fsl,sgtl5000";
					reg = <0x0a>;
					clock-frequency = <12288000>;
					VDDA-supply = <&vdig_reg>;
					VDDIO-supply = <&vvideo_reg>;
					VDDD-supply = <&vgen1_reg>;
				};*/

				hdmi: sii9022@39 {
					compatible = "sii,sii9022";
					reg = <0x39>;
					interrupt-parent = <&gpio3>;
					interrupts = <6 0x8>;
					gpios = <   &gpio3 5 0		/* reset */
						    &gpio3 4 0		/* enable (active low) */
						    &gpio3 7 0		/* vga (active low) */
						//    &gpio3 6 0
						>;	/* interrupt */

					pinctrl-names = "default";
					pinctrl-0 = <&pinctrl_display_1>;
					crtcs = <&ipu 0>;
					interface_pix_fmt = "rgb24";

/*
					display-timings {
						native-mode = <&timing0>;
						timing0: 480p30 {
							// 640x480p30
							clock-frequency = <30000000>;
							hactive = <640>;
							vactive = <480>;
							hfront-porch = <25>;
							hback-porch = <25>;
							hsync-len = <25>;
							vback-porch = <2>;
							vfront-porch = <2>;
							vsync-len = <2>;
							hsync-active = <1>;
						};
					};*/
				};
			};

			audmux: audmux@83fd0000 {
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_audmux_1>;
				status = "okay";
			};
		};


/*
		display@di1 {
			compatible = "fsl,imx-parallel-display";
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_display_1>;
			crtcs = <&ipu 1>;
			interface_pix_fmt = "rgb24";
			status = "okay";

			display-timings {
				native-mode = <&timing0>;
				timing0: 480p30 {
					// 640x480p30
					clock-frequency = <30000000>;
					hactive = <640>;
					vactive = <480>;
					hfront-porch = <25>;
					hback-porch = <25>;
					hsync-len = <25>;
					vback-porch = <2>;
					vfront-porch = <2>;
					vsync-len = <2>;
					hsync-active = <1>;
				};
			};
		};*/
	};

	gpio-keys {
		compatible = "gpio-keys";

		power {
			label = "Power Button";
			gpios = <&gpio2 31 0>;
			linux,code = <116>; /* KEY_POWER */
			gpio-key,wakeup;
		};
	};

	gpio-leds {
		compatible = "gpio-leds";

		red {
			label = "red";
			gpios = <&gpio3 15 0>;
			linux,default-trigger = "ide-disk";
		};

		green {
			label = "green";
			gpios = <&gpio3 14 0>;
			linux,default-trigger = "default-on";
		};

		blue {
			label = "blue";
			gpios = <&gpio3 13 0>;
			linux,default-trigger = "mmc0";
		};
	};

	/*sound {
		compatible = "fsl,imx-audio-sgtl5000";
		model = "efikamx-sgtl5000";
		ssi-controller = <&ssi2>;
		audio-routing =
			"MIC_IN", "Mic Jack",
			"Mic Jack", "Mic Bias",
			"Ext Spk", "LINE_OUT";
		audio-codec = <&codec>;
		mux-int-port = <2>;
		mux-ext-port = <3>;
	};*/
};
