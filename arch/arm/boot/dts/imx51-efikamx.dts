/*
 * Copyright 2011 Freescale Semiconductor, Inc.
 * Copyright 2011 Linaro Ltd.
 * Copyright 2012 Genesi USA, Inc.
 *
 * The code contained herein is licensed under the GNU General Public
 * License. You may obtain a copy of the GNU General Public License
 * Version 2 or later at the following locations:
 *
 * http://www.opensource.org/licenses/gpl-license.html
 * http://www.gnu.org/copyleft/gpl.html
 */

/dts-v1/;
/include/ "imx51.dtsi"

/ {
	model = "Genesi Efika MX (Smarttop)";
	compatible = "genesi,imx51-efikamx", "fsl,imx51";

	memory {
		reg = <0x90000000 0x20000000>;
	};

	soc {
		aips@70000000 {
			spba@70000000 {
				esdhc1: esdhc@70004000 {
					pinctrl-names = "default";
					pinctrl-0 = <&pinctrl_esdhc1_1>;
					cd-gpios = <&gpio1 0 0>;
					wp-gpios = <&gpio1 1 0>;
					status = "okay";
				};

				ssi2: ssi@70014000 {
					fsl,mode = "i2s-slave";
					status = "okay";
				};

				ecspi1: ecspi@70010000 {
					pinctrl-names = "default";
					pinctrl-0 = <&pinctrl_ecspi1_1>;
					fsl,spi-num-chipselects = <2>;
					reg = <0x70010000 0x4000>;
					cs-gpios = <&gpio4 24 0>, /* GPIO4_24 */
						   <&gpio4 25 0>; /* GPIO4_25 */
					status = "okay";

					pmic: mc13892@0 {
						#address-cells = <1>;
						#size-cells = <0>;
						compatible = "fsl,mc13892";
						spi-max-frequency = <6000000>;
						reg = <0>;
						interrupt-parent = <&gpio1>;
						interrupts = <6 0x4>;
						fsl,mc13xxx-uses-rtc;

						regulators {
							sw1_reg: sw1 {
								/* VDDGP - PUS_4 (arm core) */
								regulator-min-microvolt = <600000>;
								regulator-max-microvolt = <1100000>;
								regulator-boot-on;
								regulator-always-on;
							};

							sw2_reg: sw2 {
								/* VCC - PUS_0 (peripherals) */
								regulator-min-microvolt = <1225000>;
								regulator-max-microvolt = <1225000>;
								regulator-boot-on;
								regulator-always-on;
							};

							sw3_reg: sw3 {
								/* 1V2_DIG1 - PUS_5 HDMI, VGA */
								regulator-min-microvolt = <1200000>;
								regulator-max-microvolt = <1200000>;
								regulator-boot-on;
								regulator-always-on;
							};

							sw4_reg: sw4 {
								/* 1V8_DIG1 - PUS_1
								 * DDR, DDR-SPD & JTAG/debug board
								 * used as a voltage divider for 2.5V analog (headphone et al.) */
								regulator-min-microvolt = <1100000>;
								regulator-max-microvolt = <1800000>;
								regulator-boot-on;
								regulator-always-on;
							};

							vpll_reg: vpll {
								/* 1V8_ANA_PLL - PUS_6 */
								regulator-min-microvolt = <1800000>;
								regulator-max-microvolt = <1800000>;
								regulator-boot-on;
								regulator-always-on;
							};

							vdig_reg: vdig {
								/* 1V65 - PUS_7 SGTL5000-VDDA */
								regulator-min-microvolt = <1650000>;
								regulator-max-microvolt = <1650000>;
							};

							vsd_reg: vsd {
								/* 3V15 */
								regulator-min-microvolt = <3150000>;
								regulator-max-microvolt = <3150000>;
								regulator-always-on;
							};

							vusb_reg: vusb {
								/* 3V3_USB_MX51 - PUS_9 */
								regulator-min-microvolt = <3300000>;
								regulator-max-microvolt = <3300000>;
								regulator-always-on;
							};

							vusb2_reg: vusb2 {
								/* 2V6 - VCCUSBPHY (MX51) */
								regulator-min-microvolt = <2600000>;
								regulator-max-microvolt = <2600000>;
								regulator-always-on;
							};

							vvideo_reg: vvideo {
								/* 2V775
								 * SPI NOR, I2C2 bus, SGTL5000-VDDIO
								 * technically can be turned off but since
								 * it powers SPI NOR it needs to be back on
								 * at reboot!
								 */
								regulator-min-microvolt = <2775000>;
								regulator-max-microvolt = <2775000>;
								regulator-boot-on;
							};

							vaudio_reg: vaudio {
								/* 3V_ANA */
								regulator-min-microvolt = <3000000>;
								regulator-max-microvolt = <3000000>;
							};

							vcam_reg: vcam {
								/* 2V5 */
								regulator-min-microvolt = <2500000>;
								regulator-max-microvolt = <2500000>;
							};

							vgen1_reg: vgen1 {
								/* 1V2_DIG2 - HDMI, VGA, SGTL5000-VDDD */
								regulator-min-microvolt = <1200000>;
								regulator-max-microvolt = <1200000>;
							};

							vgen2_reg: vgen2 {
								/* 3V15_BOOT - PUS_3 - SPI NOR, SD card, VDD_FUSE */
								regulator-min-microvolt = <3150000>;
								regulator-max-microvolt = <3150000>;
								regulator-always-on;
								regulator-boot-on;
							};

							vgen3_reg: vgen3 {
								/* 1V8_DIG2
								 * required for USB (26MHz clock, USB3317 PHY, ubs, usb resets, audio */
								regulator-min-microvolt = <1800000>;
								regulator-max-microvolt = <1800000>;
								regulator-always-on;
							};

							vviohi_reg: vviohi {
								/* 2V775_BOOT - PUS_2
								 * debug board, SPDIF
								 */
								regulator-min-microvolt = <2775000>;
								regulator-max-microvolt = <2775000>;
								regulator-always-on;
								regulator-boot-on;
							};
						};
					};

					flash: sst25vf032b@1 {
						#address-cells = <1>;
						#size-cells = <1>;
						compatible = "sst,sst25vf032b";
						spi-max-frequency = <25000000>;
						reg = <1>;

						partition@0 {
							label = "firmware";
							rebig = <0x0 0x200000>;
						};

						partition@200000 {
							label = "user";
							reg = <0x200000 0x200000>;
						};
					};
				};
			};

			wdog1: wdog@73f98000 {
				status = "okay";
			};

			iomuxc: iomuxc@73fa8000 {
				compatible = "fsl,imx51-iomuxc";
				reg = <0x73fa8000 0x4000>;

				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_hog>;

				hog {
					pinctrl_hog: hoggrp {
						fsl,pins = <
							51 0x85		/* MX51_PAD_NANDF_RB3__GPIO_3_11 + 100k pullup (PCBID2) */
							53 0x85		/* MX51_PAD_NANDF_CS0__GPIO_3_16 + 100k pullup (PCBID0) */
							54 0x85		/* MX51_PAD_NANDF_CS1__GPIO_3_17 + 100k pullup (PCBID1) */
							402 0x85	/* MX51_PAD_CSPI1_SS0__GPIO4_24 */
							405 0x85	/* MX51_PAD_CSPI1_SS1__GPIO4_25 */
							694 0x85	/* MX51_PAD_GPIO1_0__SD1_CD */
							697 0x85	/* MX51_PAD_GPIO1_1__SD1_WP */
							740 0x85	/* MX51_PAD_GPIO1_6__GPIO1_6 (PMIC interrupt)*/
						>;
					};
				};

				usbotg {
					pinctrl_usbotg_1: usbotggrp-1 {
						fsl,pins = <
							461 0x1d5
							465 0x1d5
							469 0x1d5
							473 0x1d5
							476 0x1d5
							479 0x1d5
							482 0x1d5
							485 0x1d5
							488 0x1d5
							491 0x1d5
							494 0x1d5
							498 0x1d5
						>;
					};
				};
			};

			usbotg: usb@73f80000 {
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_usbotg_1>;
				vbus-supply = <&vusb_reg>;
				status = "okay";
				};

			usbhost1: usb@73f80200 {
				status = "okay";
			};

			uart1: serial@73fbc000 {
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_uart1_1>;
				fsl,uart-has-rtscts;
				status = "okay";
			};

		};

		aips@80000000 {
			sdma: sdma@83fb0000 {
				fsl,sdma-ram-script-name = "imx/sdma/sdma-imx51.bin";
			};

			i2c2: i2c@83fc4000 {
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_i2c2_1>;
				status = "okay";

				codec: sgtl5000@0a {
					compatible = "fsl,sgtl5000";
					reg = <0x0a>;
					clock-frequency = <12288000>;
					VDDA-supply = <&vdig_reg>;
					VDDIO-supply = <&vvideo_reg>;
					VDDD-supply = <&vgen1_reg>;
				};
			};

			audmux: audmux@83fd0000 {
				pinctrl-names = "default";
				pinctrl-0 = <&pinctrl_audmux_1>;
				status = "okay";
			};
		};
	};

	gpio-keys {
		compatible = "gpio-keys";

		power {
			label = "Power Button";
			gpios = <&gpio2 31 0>;
			linux,code = <116>; /* KEY_POWER */
			gpio-key,wakeup;
		};
	};

	gpio-leds {
		compatible = "gpio-leds";

		red {
			label = "red";
			gpios = <&gpio3 13>;
			linux,default-trigger = "ide-disk";
		};

		green {
			label = "green";
			gpios = <&gpio3 14>;
			linux,default-trigger = "default-on";
		};

		blue {
			label = "blue";
			gpios = <&gpio3 15>;
			linux,default-trigger = "mmc0";
		};
	};

	sound {
		compatible = "fsl,imx-audio-sgtl5000";
		model = "efikamx-sgtl5000";
		ssi-controller = <&ssi2>;
		audio-routing =
			"MIC_IN", "Mic Jack",
			"Mic Jack", "Mic Bias",
			"Ext Spk", "LINE_OUT";
		audio-codec = <&codec>;
		mux-int-port = <2>;
		mux-ext-port = <3>;
	};
};
